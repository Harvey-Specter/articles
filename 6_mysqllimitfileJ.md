場合によっては、次のようなエラー メッセージが表示されることがあります。

```
.....
[ERROR] /usr/local/mysql/bin/mysqld: Can't open file: './yejr/access.frm' (errno: 24)
[ERROR] /usr/local/mysql/bin/mysqld: Can't open file: './yejr/accesslog.frm' (errno: 24)
......
[ERROR] Error in accept: Too many open files
....
```

プロンプト情報は明らかで、開いているファイルの数が上限に達しており、上限を増やす必要があるか、開いているテーブル ファイル記述子の一部を解放する必要があります。

MySQL では、ファイル記述子の制限がいくつかの場所に存在します。

1. mysqld インスタンス全体で開いているファイルの総数が、ユーザー プロセス レベルのファイル制限を超えています。カーネルの fs.file-max 制限、プロセス レベル制限 ulimit -n、および open-files-limit オプションを確認する必要がありますMySQL を使用して、それらのいずれかが制限を超えているかどうかを確認します。 いずれかの条件を超えると、エラーがスローされます。

2. サーバー層のファイルの総数は超えていませんが、InnoDB 層にも制限があり、InnoDB に関連するオープン ファイルの総数は、innodb-open-files オプションの制限を超えることはできません。 それ以外の場合、新しいファイルを開く前に、最初に開かれた InnoDB ファイル記述子が最初に閉じられますが、エラーはスローされず、警告情報のみがスローされます。

したがって、プロンプトが制限を超えた場合は、次の方法を使用して制限を増やすことができます。

1. まず、カーネル レベルで全体的な制限を引き上げます。 実行: sysctl -w fs.file-max=3264018；

2. 次に、ユーザー プロセス レベルで開いているファイルの数に対するカーネルの制限を増やします。 実行：ulimit -n 204800；

3. 最後に、MySQL レイヤーのいくつかのパラメーターを適切に改善します：open-files-limit、innodb-open-files、table-open-cache、table-definition-cache。

最初の 2 つの制限については、インターネット上で多くの詳細な説明を見つけることができるので、これ以上は説明せず、MySQL に関連する 4 つのオプションに焦点を当てます。

1. open-files-limit
これは、mysqld プロセスが保持できるオープン ファイルの最大数を制限します. コミュニティの電気スイッチ全体のようなものです. 過負荷になると、コミュニティ内のすべての居住者が電力を失う必要があります.  
5.6.7（含）以前は、デフォルト値は 0 で、最大値は OS カーネルの制限に関連していました。
5.6.8（含）その後、デフォルト値は自動的に計算され、最大値は OS カーネルの制限に関連します。

5.6.8以降では、その自動計算のいくつかの制限ルールは次のようになり、計算結果が最も大きいものが上限になります。

* 10 + max_connections + (table_open_cache * 2)
* max_connections * 5
* open_files_limit value specified at startup, 5000 if none
 

2. innodb-open-files

	InnoDB エンジンで開いているテーブルスペース ファイルの最大数を制限します, これはあなたの家の電気ボックスの特定の回路ヒューズに相当します. 回路が短絡した場合, 他の回路に影響を与えずに自動的にトリップします. 短絡を取り除いた後-回路ソース、もう一度押してください。

	最小値は20で、デフォルト値は400です.ibdata*、ib_logfile*、*.ibdの3種類のファイルのみ計算されます.Redologは含まれていません.5.6以降は個別にundologできます.私はしていません.内部では、興味のある友人が確認できます。

3. table-definition-cache

	このパラメーターは .frm ファイルをキャッシュするために使用され、このオプションは同時に開くことができる .frm ファイルの最大数も示します。

	* 5.6.7 以前はデフォルトで 400 でした；
	* 5.6.7 その後、自動計算され、最小値は 400 です。自動計算式は次のとおりです。400 + (table-open-cache / 2)。

	InnoDB の場合、このオプションは単なるソフト リミットであり、制限を超えると、古いエントリが削除され、LRU の原則に従って新しいエントリが追加されます。

	さらに、innodb-open-files は開くことができるテーブルの最大数も制御し、table-definition-cache はどちらか大きい方で制限の役割を果たします。 制限が構成されていない場合、デフォルト値は比較的大きい 200 であるため、通常は table-definition-cache が上限として選択されます。

4. table-open-cache
   
	このパラメーターは、さまざまなすべてのデータ テーブル ファイル記述子をキャッシュするために使用されます。

	* 5.6.7 以前は、デフォルトは 400 でした。範囲:1 – 524288；
	* 5.6.8 – 5.6.11，デフォルトは 2000 でした。範囲：1 – 524288；
	* 5.6.12以后，デフォルトは 2000（自動的に計算できます），範囲：1 – 524288。

補足 1: テーブル ファイル記述子の計算方法に関する提案:

table-open-cache は通常 max-connections に関連しています. max_connections * N に設定することをお勧めします. N の値は, 各クエリで使用されるテーブルの平均数です. 同時に一時テーブルは生成されます。

補足 2: MySQL は、次の状況でテーブル キャッシュからテーブルを削除します。

1. table cache満たされた，新しいテーブルを開こうとしていた；
2. table cacheその中のエントリの数が超えています table_open_cache ，また、一部のテーブルは長い間アクセスされていません。

3. FLUSH TABLES、mysqladmin flush-tables、mysqladmin refresh などのフラッシュ テーブル操作を実行する場合
 

補足 3: MySQL では、次の方法で tablecache を割り当てます。

1. 現在使用されていないテーブルは、使用頻度の低いテーブルから順に解放されます。

2. 新しいテーブルを開く場合、現在の cache がいっぱいでテーブルを解放できない場合、table cache は一時的に拡大され、一時的に拡大されたテーブル キャッシュ内のテーブルは、使用されなくなったらすぐに解放されます